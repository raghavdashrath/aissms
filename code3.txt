from multiprocessing import Pool
import pandas as pd
import sqlite3

df = pd.read_csv("/content/forestfires.csv")
print(f"Loaded dataset with {len(df)} rows and {len(df.columns)} columns.")


conn = sqlite3.connect("forestfires.db")
df.to_sql("forestfires", conn, if_exists="replace", index=False)
print("Data saved to SQLite database.\n")

def mapper(row):
    return (row["Month"], row["Temperature_Celsius"])

def reducer(mapped_data):
    result = {}
    for month, temp in mapped_data:
        result.setdefault(month, []).append(temp)
    return {m: sum(v) / len(v) for m, v in result.items()}

with Pool() as p:
    mapped = p.map(mapper, [row for _, row in df.iterrows()])
reduced = reducer(mapped)

print("\nAverage Temperature per Month:")
for m, t in reduced.items():
    print(f"{m}: {t}")

top_n = 5
top = df.groupby("Month")["Burned_Area_hectares"].mean().sort_values(ascending=False).head(top_n)
print(f"\nTop {top_n} Months with Largest Fire Area:\n{top}\n")

corr = df["Temperature_Celsius"].corr(df["Burned_Area_hectares"])
print(f"Correlation between Temperature and Fire Area: {corr}")

query = """
    SELECT Month, AVG(Burned_Area_hectares) AS avg_area
    FROM forestfires
    GROUP BY Month
    ORDER BY avg_area DESC;
"""
result = pd.read_sql_query(query, conn)
print("\nAverage Burned Area by Month")
print(result)

